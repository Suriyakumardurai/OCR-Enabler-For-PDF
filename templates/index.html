<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OCR Enabler Pro | CUBEAI Solutions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@600;800&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7faff; color: #1a202c; }
        h1, h2, h3 { font-family: 'Manrope', sans-serif; }
        .btn { transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background-color: #2563eb; color: white; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2), 0 2px 4px -2px rgba(37, 99, 235, 0.1); }
        .btn-primary:hover { background-color: #1d4ed8; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.2), 0 4px 6px -4px rgba(37, 99, 235, 0.1); }
        .btn-primary:disabled { background-color: #93c5fd; transform: none; box-shadow: none; cursor: not-allowed; }
        .btn-secondary { background-color: #e5e7eb; color: #1f2937; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -2px rgba(0,0,0,0.05); }
        .btn-secondary:hover { background-color: #d1d5db; }
        @keyframes enter { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-enter { animation: enter 0.5s ease-out forwards; opacity: 0; }
        .stagger-children > * { animation: enter 0.5s ease-out forwards; opacity: 0; }
        .stagger-children > *:nth-child(1) { animation-delay: 0.1s; } .stagger-children > *:nth-child(2) { animation-delay: 0.2s; }
        .stagger-children > *:nth-child(3) { animation-delay: 0.3s; } .stagger-children > *:nth-child(4) { animation-delay: 0.4s; }
    </style>
</head>
<body class="antialiased">
    <div id="root"></div>
    {% raw %}
    <script type="text/babel">
        const { useState, useEffect, Fragment } = React;

        // --- ICONS & SHARED COMPONENTS ---
        const IconLogo = () => <svg className="w-8 h-8 text-blue-600" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.24L19.5 8.5 12 12.26 4.5 8.5 12 4.24zM3 8.82v6.36l8 4V13.5L3 8.82zm9 10.36l8-4V8.82L13 13.5v5.68z"></path></svg>;
        const IconPdf = () => <svg className="w-10 h-10 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>;
        const IconX = () => <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>;
        const IconArchive = () => <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>;
        const IconHome = () => <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>;
        
        function PdfModal({ file, onClose }) {
            if (!file) return null;
            useEffect(() => { const handleEsc = (e) => e.key === 'Escape' && onClose(); document.addEventListener('keydown', handleEsc); return () => document.removeEventListener('keydown', handleEsc); }, [onClose]);
            return ( <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm" onClick={onClose}> <div className="animate-enter w-full h-full max-w-4xl max-h-[90vh] bg-white rounded-xl shadow-2xl flex flex-col" onClick={e => e.stopPropagation()}> <div className="flex items-center justify-between p-4 border-b"><h3 className="text-lg font-semibold">{file}</h3><button onClick={onClose} className="p-2 text-gray-500 rounded-full hover:bg-gray-200"><IconX/></button></div> <div className="flex-grow p-2 bg-gray-100"><iframe src={`/download/${file}`} className="w-full h-full border-none rounded-b-lg"></iframe></div> </div> </div> );
        }

        // --- UPLOADER VIEW ---
        function UploaderView({ onUploadComplete }) {
            const [files, setFiles] = useState([]);
            const [isDragActive, setIsDragActive] = useState(false);
            const [lang, setLang] = useState('eng');

            const handleFiles = (incomingFiles) => {
                const pdfFiles = Array.from(incomingFiles).filter(f => f.type === 'application/pdf').map(file => ({ id: Math.random().toString(36).substring(2), file, progress: 0, error: null }));
                setFiles(prev => [...prev, ...pdfFiles].filter((f, i, self) => i === self.findIndex(t => t.file.name === f.file.name)));
            };
            const updateFileProgress = (id, progress) => setFiles(prev => prev.map(f => f.id === id ? { ...f, progress } : f));
            const setFileError = (id, error) => setFiles(prev => prev.map(f => f.id === id ? { ...f, error } : f));
            const removeFile = (id) => setFiles(files.filter(f => f.id !== id));

            const handleUpload = () => {
                const formData = new FormData();
                formData.append('lang', lang);
                files.forEach(f => { if(!f.error) formData.append('files', f.file) });
                const xhr = new XMLHttpRequest();
                xhr.open('POST', '/upload', true);
                xhr.upload.onprogress = (event) => { if (event.lengthComputable) { const percent = Math.round((event.loaded / event.total) * 100); files.forEach(f => updateFileProgress(f.id, percent)); } };
                xhr.onload = () => {
                    if (xhr.status === 200) { onUploadComplete(JSON.parse(xhr.responseText).processed_files); }
                    else { const msg = "Upload failed. Please try again."; files.forEach(f => setFileError(f.id, msg)); }
                };
                xhr.onerror = () => { const msg = "Network error. Check connection."; files.forEach(f => setFileError(f.id, msg)); };
                xhr.send(formData);
            };

            return (
                <div className="px-8 pb-20">
                    <section className="text-center max-w-4xl mx-auto pt-16 pb-20"><h1 className="text-6xl md:text-7xl font-extrabold text-gray-900 tracking-tighter">Unlock Your Documents.</h1><p className="max-w-2xl mx-auto mt-6 text-xl text-gray-600">Harness the power of AI to convert your scanned PDFs into fully searchable, intelligent assets.</p></section>
                    <section className="max-w-4xl mx-auto">
                        <div onDragEnter={(e) => {e.preventDefault(); e.stopPropagation(); setIsDragActive(true);}} onDragLeave={(e) => {e.preventDefault(); e.stopPropagation(); setIsDragActive(false);}} onDragOver={(e) => {e.preventDefault(); e.stopPropagation();}} onDrop={(e) => {e.preventDefault(); e.stopPropagation(); setIsDragActive(false); handleFiles(e.dataTransfer.files);}}>
                            <label htmlFor="file-upload" className={`relative block w-full border-2 border-dashed rounded-2xl p-12 text-center cursor-pointer transition-all ${isDragActive ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-400 bg-white'}`}><svg className={`w-16 h-16 mx-auto transition-colors ${isDragActive ? 'text-blue-600' : 'text-gray-400'}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 12v9" /><path strokeLinecap="round" strokeLinejoin="round" d="M15 16l-3-3-3 3" /></svg><p className="mt-4 text-xl font-semibold">Drag & drop PDFs here</p><p className="text-gray-500">or click to select files</p><input id="file-upload" type="file" name="files" multiple accept="application/pdf" className="sr-only" onChange={(e) => handleFiles(e.target.files)} /></label>
                        </div>
                        {files.length > 0 && <div className="mt-8"><h3 className="text-lg font-semibold mb-4">Ready to Process:</h3><ul className="space-y-3">{files.map(({id, file, progress, error}) => <li key={id} className="bg-white border rounded-lg p-4 shadow-sm overflow-hidden"><div className="flex items-center justify-between"><div className="flex items-center space-x-4"><svg className="w-6 h-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg><span className="font-medium">{file.name}</span></div><button onClick={() => removeFile(id)} className="text-gray-500 hover:text-red-600"><IconX /></button></div>{progress > 0 && <div className="mt-3 w-full bg-gray-200 rounded-full h-2.5"><div className="bg-blue-600 h-2.5 rounded-full" style={{width: `${progress}%`}}></div></div>}{error && <p className="text-red-500 text-sm mt-2">{error}</p>}</li>)}</ul></div>}
                        <div className="mt-10 flex flex-col md:flex-row items-center gap-6"><div className="relative w-full md:w-1/3"><select value={lang} onChange={e => setLang(e.target.value)} className="w-full text-base py-3 px-4 border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500"><option value="eng">English</option><option value="tam">Tamil</option><option value="hin">Hindi</option></select></div><button onClick={handleUpload} disabled={files.length === 0} className="btn btn-primary w-full md:w-2/3 py-3 px-6 text-lg font-semibold rounded-lg">Process {files.length} File{files.length !== 1 ? 's' : ''}</button></div>
                    </section>
                    <section className="max-w-5xl mx-auto text-center pt-28 pb-16">
                        <h2 className="text-4xl font-bold text-gray-900">Key Features</h2>
                        <div className="mt-12 grid md:grid-cols-3 gap-12 text-left">
                            <div className="p-6"><h3 className="text-xl font-bold text-gray-800">High-Accuracy OCR</h3><p className="mt-2 text-gray-600">Our engine analyzes, deskews, and extracts text with industry-leading precision.</p></div>
                            <div className="p-6"><h3 className="text-xl font-bold text-gray-800">Secure & Private</h3><p className="mt-2 text-gray-600">Your documents are processed securely and are never stored longer than necessary.</p></div>
                            <div className="p-6"><h3 className="text-xl font-bold text-gray-800">Searchable Archive</h3><p className="mt-2 text-gray-600">Instantly access, preview, and download any of your previously processed files.</p></div>
                        </div>
                    </section>
                </div>
            );
        }

        // --- RESULTS VIEW ---
        function ResultsView({ processedFiles, onProcessMore }) {
            const [viewingFile, setViewingFile] = useState(null);
            const fileCount = processedFiles.length;
            return (
                <div className="px-8 pb-20">
                    <PdfModal file={viewingFile} onClose={() => setViewingFile(null)} />
                    <section className="max-w-5xl mx-auto pt-16 pb-12 text-center"><div className="inline-block p-4 bg-green-100 rounded-full animate-enter" style={{animationDelay:'0.1s'}}><svg className="w-12 h-12 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" /></svg></div><h1 className="text-5xl font-extrabold tracking-tighter mt-6 animate-enter" style={{animationDelay:'0.2s'}}>Processing Complete</h1><p className="max-w-2xl mx-auto mt-4 text-xl text-gray-600 animate-enter" style={{animationDelay:'0.3s'}}>Your documents are now searchable and ready.</p></section>
                    <section className="max-w-5xl mx-auto"><div className={`stagger-children ${fileCount === 1 ? 'flex justify-center' : ''} ${fileCount === 2 ? 'grid sm:grid-cols-2 gap-8' : ''} ${fileCount > 2 ? 'grid sm:grid-cols-2 lg:grid-cols-3 gap-8' : ''}`}> {processedFiles.map(file => ( <div key={file} className={`bg-white border rounded-2xl shadow-md overflow-hidden flex flex-col transition-all hover:shadow-xl hover:-translate-y-1 ${fileCount === 1 ? 'w-full max-w-sm' : ''}`}><div className="p-6 flex-grow"><IconPdf /><h3 className="font-bold text-lg mt-4 break-words">{file}</h3></div><div className="p-4 bg-gray-50 border-t grid grid-cols-2 gap-3"><button onClick={() => setViewingFile(file)} className="btn btn-secondary w-full text-sm font-semibold rounded-lg py-2 px-4">Preview</button><a href={`/download/${file}`} download className="btn btn-primary w-full text-center text-sm font-semibold rounded-lg py-2 px-4">Download</a></div></div> ))} </div><div className="mt-16 border-t pt-10 flex flex-col md:flex-row items-center justify-center gap-6"><a href="/download-zip" className="btn btn-primary py-3 px-8 text-base font-semibold rounded-lg w-full md:w-auto">Download All as ZIP</a><button onClick={onProcessMore} className="btn btn-secondary py-3 px-8 text-base font-semibold rounded-lg w-full md:w-auto">Process More Files</button></div></section>
                </div>
            );
        }
        
        // --- ARCHIVE VIEW ---
        function ArchiveView() {
            const [files, setFiles] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [viewingFile, setViewingFile] = useState(null);

            useEffect(() => { fetch('/processed-files').then(res => res.json()).then(data => { setFiles(data.files || []); setIsLoading(false); }).catch(err => { setError("Could not load archive."); setIsLoading(false); }); }, []);
            const filteredFiles = files.filter(f => f.toLowerCase().includes(searchTerm.toLowerCase()));
            const fileCount = filteredFiles.length;

            return (
                <div className="px-8 pb-20">
                    <PdfModal file={viewingFile} onClose={() => setViewingFile(null)} />
                    <section className="text-center max-w-4xl mx-auto pt-16 pb-16"><h1 className="text-5xl md:text-6xl font-extrabold tracking-tighter">Digital Archive.</h1><p className="max-w-2xl mx-auto mt-5 text-lg text-gray-600">Browse, preview, and download your previously processed documents.</p></section>
                    <section className="max-w-5xl mx-auto"><div className="mb-8"><input type="search" placeholder="Search archive by filename..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full text-base py-3 px-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" /></div>
                        {isLoading ? <p className="text-center">Loading Archive...</p> : error ? <p className="text-center text-red-500">{error}</p> : (
                            fileCount === 0 ? <div className="text-center text-gray-500 text-lg py-16">{searchTerm ? 'No files match your search.' : 'Your archive is empty.'}</div> :
                            <div className={`stagger-children ${fileCount === 1 ? 'flex justify-center' : ''} ${fileCount === 2 ? 'grid sm:grid-cols-2 gap-8' : ''} ${fileCount > 2 ? 'grid sm:grid-cols-2 lg:grid-cols-3 gap-8' : ''}`}>{filteredFiles.map(file => <div key={file} className={`bg-white border rounded-2xl shadow-md overflow-hidden flex flex-col transition-all hover:shadow-xl hover:-translate-y-1 ${fileCount === 1 ? 'w-full max-w-sm' : ''}`}><div className="p-6 flex-grow"><IconPdf /><h3 className="font-bold text-lg mt-4 break-words">{file}</h3></div><div className="p-4 bg-gray-50 border-t grid grid-cols-2 gap-3"><button onClick={() => setViewingFile(file)} className="btn btn-secondary w-full text-sm font-semibold rounded-lg py-2 px-4">Preview</button><a href={`/download/${file}`} download className="btn btn-primary w-full text-center text-sm font-semibold rounded-lg py-2 px-4">Download</a></div></div>)}</div>
                        )}
                    </section>
                </div>
            );
        }

        // --- MAIN APP ---
        function App() {
            const [view, setView] = useState('uploader'); // uploader, results, archive
            const [processedFiles, setProcessedFiles] = useState([]);
            const handleUploadComplete = (files) => { setProcessedFiles(files); setView('results'); };
            
            // This function scrolls to the top when the view changes
            useEffect(() => {
                window.scrollTo(0, 0);
            }, [view]);
            
            return (
                <Fragment>
                    <header className="py-4 px-8 flex items-center justify-between sticky top-0 bg-white/80 backdrop-blur-md z-10 border-b">
                        <button onClick={() => setView('uploader')} className="flex items-center space-x-3"><IconLogo /><span className="text-xl font-semibold text-gray-800">CUBEAI Solutions</span></button>
                        <button onClick={() => setView(view === 'archive' ? 'uploader' : 'archive')} className="p-2 rounded-full hover:bg-gray-200 transition-colors" title={view === 'archive' ? 'Go to Uploader' : 'View Archive'}>{view === 'archive' ? <IconHome /> : <IconArchive />}</button>
                    </header>
                    
                    {/* The new layout logic: use `hidden` to let the page flow naturally */}
                    <main>
                        <div className={view === 'uploader' ? '' : 'hidden'}><UploaderView onUploadComplete={handleUploadComplete} /></div>
                        <div className={view === 'results' ? '' : 'hidden'}><ResultsView processedFiles={processedFiles} onProcessMore={() => setView('uploader')} /></div>
                        <div className={view === 'archive' ? '' : 'hidden'}><ArchiveView /></div>
                    </main>

                    <footer className="py-6 px-8 text-center text-gray-500 border-t bg-white"><p>&copy; 2025 CUBEAI Solutions. All Rights Reserved.</p></footer>
                </Fragment>
            );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
    {% endraw %}
</body>
</html>